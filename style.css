body {
    font-family: sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
    color: #333;
}

header {
    background: #333;
    color: #fff;
    padding: 1rem 0;
    text-align: center;
}

main {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: 1fr 3fr;
    gap: 20px;
}

section {
    background: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

#simulation-area {
    grid-column: 2 / 3;
    grid-row: 1; /* Explicitly set row */
    position: relative; /* Needed for absolute positioning of lines */
}

#controls, #explanation, #quiz {
    grid-column: 1 / 2;
    grid-row: 1; /* Explicitly set row */
    /* Allow items to flow naturally in the column */
}

/* --- Animation for highlighting explanation step --- */
@keyframes highlight-step-anim {
    0% { background-color: #fff; } /* Start normal */
    50% { background-color: #fff3cd; } /* Flash light yellow */
    100% { background-color: #fff; } /* End normal */
}

.step-highlight {
    animation-name: highlight-step-anim;
    animation-duration: 0.8s; /* Duration of the flash */
    animation-timing-function: ease-out;
}
/* --- End Animation ---*/

#explanation {
    margin-top: 0; /* Remove potential extra margin if controls/explanation were separated */
}

#nodes {
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin-bottom: 30px;
    min-height: 100px;
}

.node {
    background: #5cb85c;
    color: white;
    padding: 15px 25px;
    border-radius: 50%;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    position: relative; /* Needed for z-index stacking context */
    z-index: 10; /* Nodes above lines */
}

#attacker {
    background: #d9534f;
}

#messages {
    position: relative; /* Needed for absolute positioning of message arrows */
    max-height: 450px; /* Set a max height */
    overflow-y: auto;  /* Enable vertical scrolling when content exceeds max-height */
    border: 1px dashed #ccc;
    padding: 10px;
    margin-top: 20px;
}

/* Style for the placeholder message in the messages area */
.placeholder-message {
    color: #6c757d; /* Grey color */
    font-style: italic;
    text-align: center;
    padding: 20px;
}

/* Simple message styling - will need enhancement for arrows/animation */
.message {
    background: #f0f0f0; /* Lighter background */
    padding: 8px 12px; /* Slightly more padding */
    margin-bottom: 8px; /* Increased margin */
    border-radius: 4px;
    border-left: 4px solid #ccc; /* Default border */
    font-size: 0.9em;
}

/* Hover effect for messages with tooltips */
.message.has-tooltip:hover {
    background-color: #e9ecef; /* Slightly darker grey */
    cursor: help;
}

/* Style for clickable certificate messages */
.message.clickable-certificate {
    text-decoration: underline;
    color: #0056b3; /* Standard link blue */
    cursor: pointer; /* Ensure pointer cursor */
}

.message.clickable-certificate strong {
    /* Ensure strong tag inherits the link color */
    color: inherit; 
}

.message.clickable-certificate:hover {
    background-color: #ddeeff; /* Light blue highlight on hover */
}

.message.client-msg {
    border-left-color: #5bc0de; /* Blue for client */
}

.message.server-msg {
    border-left-color: #5cb85c; /* Green for server */
}

.message.attacker-msg {
    border-left-color: #d9534f; /* Red for attacker */
}

/* Styles for the animated packet */
.packet {
    position: absolute;
    width: 20px;
    height: 15px;
    background-color: #ffcc00; /* Yellow packet */
    border: 1px solid #cc9900;
    border-radius: 3px;
    z-index: 20; /* Packets above nodes and lines */
    transition: left 1s ease-in-out, top 1s ease-in-out; /* Animation timing */
    font-size: 0.7em;
    text-align: center;
    line-height: 15px;
    overflow: hidden;
}

button {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    background: #337ab7;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 1rem;
}

button:hover {
    background: #286090;
}

#toggle-attack.active {
    background: #d9534f; /* Red when attacker is active */
}

#toggle-attack.active:hover {
    background: #c9302c;
}

.hidden {
    display: none !important; /* Use !important cautiously */
}

footer {
    text-align: center;
    margin-top: 20px;
    padding: 10px;
    background: #ddd;
    color: #333;
}

/* Basic Responsive adjustments */
@media (max-width: 768px) {
    main {
        grid-template-columns: 1fr; /* Stack columns on smaller screens */
    }

    #simulation-area, #controls, #explanation, #quiz {
        grid-column: 1 / -1; /* Take full width */
    }

    #nodes {
        flex-direction: column; /* Stack nodes vertically */
        align-items: center;
    }

    .node {
        margin-bottom: 15px;
    }
}

/* Styles for connection lines */
.connection-line {
    position: absolute;
    height: 4px; /* Line thickness */
    background-color: #adb5bd; /* Grey line color */
    z-index: 1; /* Lines behind nodes and packets */
    transform-origin: left center;
    /* Positioning will be set by JS, but provide defaults */
    top: 50%; 
    left: 25%; 
    width: 50%;
}

/* Specific line styling (can be adjusted later) */
#line-client-server {
    /* Default visible line */
}

#line-client-attacker {
    background-color: #f0ad4e; /* Orange for potential attack path */
    /* Default hidden, positioning set by JS */
}

#line-attacker-server {
    background-color: #f0ad4e; /* Orange for potential attack path */
    /* Default hidden, positioning set by JS */
}

/* Tooltip Styling */
#tooltip {
    position: absolute; /* Positioned relative to the body */
    background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black */
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.85em;
    max-width: 250px; /* Prevent it from becoming too wide */
    z-index: 100; /* Ensure it's above everything else */
    pointer-events: none; /* Prevent tooltip from interfering with mouse events */
    white-space: pre-wrap; /* Allow line breaks in content */
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

#tooltip.hidden {
    display: none;
}

/* Quiz specific styles */
#quiz-options label {
    display: block;
    margin-bottom: 8px;
    cursor: pointer;
}
#quiz-options input[type="radio"] {
    margin-right: 8px;
}

#quiz-feedback {
    margin-top: 15px;
    font-weight: bold;
}

#quiz-feedback.correct {
    color: #5cb85c; /* Green */
}

#quiz-feedback.incorrect {
    color: #d9534f; /* Red */
}

/* Style for control options like checkboxes */
.control-option {
    margin-top: 15px;
    padding: 5px;
    background-color: #f9f9f9;
    border: 1px solid #eee;
    border-radius: 3px;
}
.control-option label {
    cursor: pointer;
    margin-left: 5px;
}

/* Container for pause/resume/replay */
.simulation-controls {
    display: flex; /* Arrange buttons side-by-side */
    gap: 10px;     /* Space between buttons */
    margin-top: 10px;
}

.simulation-controls button {
    flex-grow: 1; /* Make buttons share space */
    /* Adjust styling as needed */
     background-color: #ffc107; /* Amber color */
}
.simulation-controls button:hover {
     background-color: #e0a800;
}

/* Style for the Clear button */
#clear-simulation {
    background-color: #6c757d; /* Grey color */
}
#clear-simulation:hover {
    background-color: #5a6268;
}

/* Modal Styles */
.modal {
    position: fixed; /* Stay in place */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 1000; /* Above everything else */
    display: flex; /* Use flexbox for centering */
    justify-content: center;
    align-items: center;
}

.modal.hidden {
    display: none;
}

.modal-overlay {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black overlay */
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 5px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1001; /* Above overlay */
    max-width: 500px;
    width: 90%;
    position: relative; /* For positioning the close button */
}

.modal-close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 1.8rem;
    color: #aaa;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

.modal-close-btn:hover {
    color: #333;
}

#modal-body p {
    margin-bottom: 10px;
    line-height: 1.4;
}

#modal-body strong {
    display: inline-block;
    min-width: 100px;
} 